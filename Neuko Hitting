<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>9-Hole Neuko Head Hit</title>
  <style>
    :root{--bg:#071026;--card:#071726;--accent:#ffb300}
    *{box-sizing:border-box;font-family:Inter,Segoe UI,system-ui,Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#021428 0%,#071026 100%);color:#e6eef8}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .game{width:920px;max-width:100%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .title{font-size:20px;font-weight:700;display:flex;gap:12px;align-items:center}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}
    .stats{display:flex;gap:14px;align-items:center}
    .stat{background:rgba(255,255,255,0.02);padding:8px 12px;border-radius:10px;font-weight:600}

    .board{width:640px;max-width:100%;margin:16px auto 8px;display:grid;grid-template-columns:repeat(3,1fr);gap:18px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);border-radius:12px}
    .hole{position:relative;height:160px;background:radial-gradient(circle at 50% 30%, #0b2b3f, #041726 35%, #021321 60%);border-radius:12px;overflow:visible;display:flex;align-items:end;justify-content:center}

    .cap{position:absolute;left:50%;transform:translateX(-50%);bottom:8px;width:82%;height:40px;background:linear-gradient(180deg,#061626,#03202b);border-radius:999px;box-shadow: inset 0 -6px 16px rgba(0,0,0,0.5);z-index:3}

    /* head container masks lower body - only top section visible */
    .headWrap{position:absolute;left:50%;transform:translateX(-50%);bottom:8px;width:88px;height:88px;border-radius:999px;overflow:hidden;pointer-events:auto;z-index:4}
    .headInner{position:absolute;left:50%;transform:translate(-50%,40%);width:160px;height:160px;transition:transform 220ms cubic-bezier(.2,.9,.3,1),filter 200ms;}
    .pop .headInner{transform:translate(-50%,-18%);} /* when popped, image moves up to show head only */

    /* hit animation */
    .headWrap.hit .headInner{animation:shake 300ms ease-out;}
    @keyframes shake{0%{transform:translate(-50%,-18%) rotate(0)}25%{transform:translate(-50%,-18%) rotate(-12deg)}50%{transform:translate(-50%,-18%) rotate(8deg)}75%{transform:translate(-50%,-18%) rotate(-6deg)}100%{transform:translate(-50%,-18%) rotate(0)} }

    /* overlays for expressions */
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .overlay svg{width:88px;height:88px}

    /* particles */
    .particle{position:absolute;width:10px;height:10px;border-radius:50%;opacity:0.95;transform:translate(-50%,-50%);animation:part 700ms ease-out forwards}
    @keyframes part{to{transform:translate(-50%,-160%) scale(0.3);opacity:0}} 

    /* score popup */
    .popup{position:absolute;font-weight:800;font-size:14px;pointer-events:none;opacity:0;transform:translateY(0);transition:all 600ms ease-out}
    .popup.show{opacity:1;transform:translateY(-28px)}

    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .small{font-size:13px;opacity:0.85}

    @media (max-width:720px){.board{gap:12px;padding:12px}.hole{height:120px}.headWrap{width:68px;height:68px}.headInner{width:130px;height:130px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game" role="application" aria-label="9-hole neuko head hit game">
      <div class="top">
        <div class="title">üï≥Ô∏è 9-Hole Neuko</div>
        <div class="controls">
          <button id="startBtn">Start</button>
          <button id="stopBtn" class="secondary">Stop</button>
          <div class="stats">
            <div class="stat">Time: <span id="time">30</span>s</div>
            <div class="stat">Score: <span id="score">0</span></div>
          </div>
        </div>
      </div>

      <div id="board" class="board" aria-live="polite"></div>

      <div class="footer">
        <div class="small">Only the heads appear while popping up. Bottoms remain hidden.</div>
        <div class="small">Ready ‚Äî save and open this file in your browser.</div>
      </div>
    </div>
  </div>

  <script>
    // Embedded transparent PNG of the character (user-supplied) as base64
    const faceBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATUAAAFBCAYAAAAWrDjTAAEAAElEQVR4nHz9SY8tTZIliB3Ryczu4O7vGyK+jMjIqaqyi80ugkCDC3LDBQGCa275gwkSIEA0";

    const board = document.getElementById('board');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const timeEl = document.getElementById('time');
    const scoreEl = document.getElementById('score');

    const GAME_TIME = 30;
    let timeLeft = GAME_TIME;
    let score = 0;
    let popInterval = null;
    let countdown = null;
    let active = false;

    // build 9 holes
    for(let i=0;i<9;i++){
      const hole = document.createElement('div');
      hole.className = 'hole';
      hole.dataset.index = i;

      const headWrap = document.createElement('div');
      headWrap.className = 'headWrap';
      headWrap.tabIndex = 0;

      const headInner = document.createElement('img');
      headInner.className = 'headInner';
      headInner.draggable = false;
      headInner.src = faceBase64;
      headInner.alt = 'neuko head';

      // overlays: normal / hit / dizzy
      const overlayNormal = document.createElement('div'); overlayNormal.className='overlay normal';
      overlayNormal.innerHTML = `<!-- none: keep original art -->`;

      const overlayHit = document.createElement('div'); overlayHit.className='overlay hitOverlay';
      overlayHit.innerHTML = `<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'><g stroke='white' stroke-width='6' stroke-linecap='round'><line x1='30' y1='36' x2='46' y2='52'/><line x1='46' y1='36' x2='30' y2='52'/><line x1='70' y1='36' x2='86' y2='52'/><line x1='86' y1='36' x2='70' y2='52'/></g><ellipse cx='50' cy='70' rx='16' ry='10' fill='rgba(0,0,0,0.85)' stroke='white' stroke-width='3'/></svg>`;

      const overlayDizzy = document.createElement('div'); overlayDizzy.className='overlay dizzyOverlay';
      overlayDizzy.innerHTML = `<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'><g stroke='white' stroke-width='5' stroke-linecap='round'><path d='M28 40 q12 12 24 0' fill='none'/><path d='M72 40 q12 12 24 0' transform='translate(-48,0)' fill='none'/></g><g transform='translate(20,10)' stroke='white' stroke-width='4'><path d='M10 20 q10 -12 30 -6 q-6 10 -18 18' fill='none'/></g></svg>`;

      // score popup
      const popup = document.createElement('div'); popup.className='popup'; popup.textContent = '+1';

      headWrap.appendChild(headInner);
      headWrap.appendChild(overlayNormal);
      headWrap.appendChild(overlayHit);
      headWrap.appendChild(overlayDizzy);
      headWrap.appendChild(popup);

      const cap = document.createElement('div'); cap.className = 'cap';

      hole.appendChild(headWrap);
      hole.appendChild(cap);
      board.appendChild(hole);

      // initialize overlay visibility
      overlayHit.style.display='none'; overlayDizzy.style.display='none';

      // pointer interaction
      headWrap.addEventListener('pointerdown', (e)=>{
        if(!active) return;
        // only accept hits when popped visible
        if(!headWrap.classList.contains('pop')) return;
        // hit effect
        headWrap.classList.add('hit');
        overlayHit.style.display='flex'; overlayNormal.style.display='none';
        speakNeuko();
        spawnParticles(hole, e.clientX, e.clientY);
        showPopup(popup);
        score += 1; scoreEl.textContent = score;
        setTimeout(()=>{ overlayHit.style.display='none'; overlayDizzy.style.display='flex'; headWrap.classList.remove('hit'); }, 220);
        setTimeout(()=>{ overlayDizzy.style.display='none'; overlayNormal.style.display='none'; headWrap.classList.remove('pop'); }, 900);
      });

      headWrap.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); headWrap.dispatchEvent(new PointerEvent('pointerdown',{bubbles:true})); } });
    }

    const holes = Array.from(document.querySelectorAll('.hole'));

    function randomHole(){ return holes[Math.floor(Math.random()*holes.length)]; }

    function popOne(){
      const hole = randomHole();
      const headWrap = hole.querySelector('.headWrap');
      if(headWrap.classList.contains('pop')) return;
      headWrap.classList.add('pop');
      // ensure overlays reset
      headWrap.querySelector('.overlay.normal').style.display='none';
      headWrap.querySelector('.overlay.hitOverlay').style.display='none';
      headWrap.querySelector('.overlay.dizzyOverlay').style.display='none';
      // show neutral by fading image slightly (no SVG change)
      // auto-hide after random time
      const stay = 600 + Math.random()*900;
      setTimeout(()=>{ if(headWrap.classList.contains('pop')) headWrap.classList.remove('pop'); }, stay);
    }

    function startGame(){
      if(active) return; active=true; score=0; scoreEl.textContent=score; timeLeft=GAME_TIME; timeEl.textContent=timeLeft;
      popInterval = setInterval(popOne,400);
      countdown = setInterval(()=>{ timeLeft-=1; timeEl.textContent=timeLeft; if(timeLeft===Math.floor(GAME_TIME*0.6)){ clearInterval(popInterval); popInterval=setInterval(popOne,340);} if(timeLeft===Math.floor(GAME_TIME*0.3)){ clearInterval(popInterval); popInterval=setInterval(popOne,280);} if(timeLeft<=0){ stopGame(); } },1000);
    }

    function stopGame(){ active=false; clearInterval(popInterval); popInterval=null; clearInterval(countdown); countdown=null; document.querySelectorAll('.headWrap').forEach(h=>{ h.classList.remove('pop'); h.classList.remove('hit'); h.querySelector('.overlay.hitOverlay').style.display='none'; h.querySelector('.overlay.dizzyOverlay').style.display='none'; }); }

    startBtn.addEventListener('click', startGame);
    stopBtn.addEventListener('click', stopGame);

    // particles and popup
    function spawnParticles(hole, clientX, clientY){
      for(let i=0;i<6;i++){
        const p = document.createElement('div'); p.className='particle'; p.style.background = ['#ffb300','#ffd166','#ff8c42'][Math.floor(Math.random()*3)];
        // position relative to hole
        const rect = hole.getBoundingClientRect();
        const x = (clientX || rect.left + rect.width/2) - rect.left;
        const y = (clientY || rect.top + rect.height/2) - rect.top - 10;
        p.style.left = x + 'px'; p.style.top = y + 'px';
        hole.appendChild(p);
        setTimeout(()=>p.remove(),800);
      }
      // slight screen shake
      document.querySelector('.game').style.transform = 'translateY(-4px)';
      setTimeout(()=>{ document.querySelector('.game').style.transform = ''; },120);
    }

    function showPopup(popup){ popup.classList.add('show'); setTimeout(()=>popup.classList.remove('show'),600); }

    // Speech: play "Neuko" with a dark / low voice as requested (D)
    function speakNeuko(){
      try{
        const ut = new SpeechSynthesisUtterance('Neuko');
        // choose a voice that contains 'en' if possible
        const voices = window.speechSynthesis.getVoices();
        // pick a voice with 'male' or default, then tune pitch/rate
        if(voices && voices.length){
          // prefer voices with 'Google' or 'en-US'
          let v = voices.find(v=>/en-|Google|Microsoft|Samantha|Daniel/i.test(v.name)) || voices[0];
          ut.voice = v;
        }
        ut.rate = 0.9; ut.pitch = 0.45; ut.volume = 1.0;
        // slight delay to ensure voice is loaded in some browsers
        setTimeout(()=>speechSynthesis.speak(ut),10);
      }catch(e){ console.warn('Speech failed', e); }
    }

    // Accessibility: ESC to stop
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') stopGame(); });

  </script>
</body>
</html>
